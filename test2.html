<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PhotoBooth</title>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-HH1GXQ3CP4"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-HH1GXQ3CP4');
    </script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background: #fce7f3;
            color: #8a4af3;
        }

        h2, h3 {
            color: #ff6f91;
            font-family: 'Courier New', cursive;
            font-size: 2rem;
        }

        p {
            font-size: 1.1rem;
        }

        #camera-container {
            display: none;
            position: relative;
            max-width: 100%;
            padding: 15px;
        }

        #countdown {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2.5rem;
            font-weight: bold;
            color: #ffffff;
            background: rgba(255, 111, 145, 0.4);
            padding: 20px 30px;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            font-family: 'Courier New', cursive;
            animation: pulse 0.5s infinite alternate;
            z-index: 10;
        }

        @keyframes pulse {
            0% { transform: translate(-50%, -50%) scale(1); }
            100% { transform: translate(-50%, -50%) scale(1.05); }
        }

        .photo-frame {
            width: 200px;
            height: 200px;
            object-fit: cover;
            margin: 0;
            border-radius: 0;
            position: relative;
        }

        #photo-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0;
        }

        .frame,
        .background-option {
            width: 50px;
            height: 50px;
            cursor: pointer;
            border-radius: 50%;
            background-size: cover;
            background-position: center;
            transition: transform 0.3s ease;
            position: relative;
            margin: 5px;
        }

        .frame:hover,
        .background-option:hover {
            transform: scale(1.15);
        }

        .frame.selected,
        .background-option.selected,
        .layout-btn.selected,
        .effect-btn.selected {
            transform: scale(1.15);
            outline: 2px solid #ff6f91;
            outline-offset: 2px;
        }

        .btn-custom {
            background-color: #ff9cc7;
            border: none;
            border-radius: 25px;
            color: white;
            padding: 10px 25px;
            font-size: 1.1rem;
            min-width: 150px;
            transition: transform 0.3s ease, background-color 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-custom:hover {
            background-color: #f78fb3;
            transform: scale(1.05);
        }

        .btn-danger {
            background-color: #ff6f91;
        }

        .btn-danger:hover {
            background-color: #f55d7e;
        }

        .btn-success {
            background-color: #c3e6fc;
            color: #ff6f91;
        }

        .btn-success:hover {
            background-color: #b0d8f5;
        }

        .btn-flip {
            background-color: #e0c3fc;
        }

        .btn-flip:hover {
            background-color: #d1b3f5;
        }

        #frame-selection h4,
        #effect-selection h4,
        #layout-selection h4,
        #background-selection h4,
        .modal h4 {
            color: #ff6f91;
            font-family: 'Courier New', cursive;
        }

        .frame-container,
        .effect-container,
        .layout-container,
        .background-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .frame-white {
            background: #ffffff;
            border: 2px dashed #ff6f91;
        }

        .frame-stars::after {
            content: '‚òÖ';
            position: absolute;
            top: 5px;
            left: 5px;
            color: #ff6f91;
            font-size: 18px;
        }

        .frame-stars::before {
            content: '‚òÖ';
            position: absolute;
            bottom: 5px;
            right: 5px;
            color: #ff6f91;
            font-size: 18px;
        }

        .frame-hearts::after {
            content: '‚ô•';
            position: absolute;
            top: 5px;
            left: 5px;
            color: #ff69b4;
            font-size: 20px;
        }

        .frame-hearts::before {
            content: '‚ô•';
            position: absolute;
            bottom: 5px;
            right: 5px;
            color: #ff69b4;
            font-size: 20px;
        }

        .frame-sunflowers::after {
            content: 'üåª';
            position: absolute;
            top: 5px;
            left: 5px;
            font-size: 20px;
        }

        .frame-sunflowers::before {
            content: 'üåª';
            position: absolute;
            bottom: 5px;
            right: 5px;
            font-size: 20px;
        }

        .frame-flowers::after {
            content: '‚ùÄ';
            position: absolute;
            top: 5px;
            left: 5px;
            color: #ff9cc7;
            font-size: 20px;
        }

        .frame-flowers::before {
            content: '‚ùÄ';
            position: absolute;
            bottom: 5px;
            right: 5px;
            color: #ff9cc7;
            font-size: 20px;
        }

        .frame-bows::after {
            content: 'üéÄ';
            position: absolute;
            top: 5px;
            left: 5px;
            color: #ff69b4;
            font-size: 20px;
        }

        .frame-bows::before {
            content: 'üéÄ';
            position: absolute;
            bottom: 5px;
            right: 5px;
            color: #ff69b4;
            font-size: 20px;
        }

        .frame-bunnies::after {
            content: 'üê∞';
            position: absolute;
            top: 5px;
            left: 5px;
            font-size: 20px;
        }

        .frame-bunnies::before {
            content: 'üê∞';
            position: absolute;
            bottom: 5px;
            right: 5px;
            font-size: 20px;
        }

        .frame-waves {
            background: linear-gradient(45deg, #ffffff, #ff9cc7);
        }

        .frame-clouds::after {
            content: '‚òÅ';
            position: absolute;
            top: 5px;
            left: 5px;
            color: #c3e6fc;
            font-size: 20px;
        }

        .frame-clouds::before {
            content: '‚òÅ';
            position: absolute;
            bottom: 5px;
            right: 5px;
            color: #c3e6fc;
            font-size: 20px;
        }

        .frame-cats::after {
            content: 'üêæ';
            position: absolute;
            top: 5px;
            left: 5px;
            color: #ff6f91;
            font-size: 20px;
        }

        .frame-cats::before {
            content: 'üêæ';
            position: absolute;
            bottom: 5px;
            right: 5px;
            color: #ff6f91;
            font-size: 20px;
        }

        .frame-pusheen::after {
            content: 'üê±';
            position: absolute;
            top: 5px;
            left: 5px;
            font-size: 20px;
        }
        .frame-pusheen::before {
            content: 'üçî';
            position: absolute;
            bottom: 5px;
            right: 5px;
            font-size: 20px;
        }

        .frame-rainbow {
            background: linear-gradient(90deg, #ff6f61, #ffd700, #ff69b4, #87ceeb);
        }

        .frame-diamonds::after {
            content: '‚ô¶';
            position: absolute;
            top: 5px;
            left: 5px;
            color: #ff6f91;
            font-size: 20px;
        }
        .frame-diamonds::before {
            content: '‚ô¶';
            position: absolute;
            bottom: 5px;
            right: 5px;
            color: #ff6f91;
            font-size: 20px;
        }

        .frame-moon::after {
            content: 'üåô';
            position: absolute;
            top: 5px;
            left: 5px;
            font-size: 20px;
        }
        .frame-moon::before {
            content: '‚ú®';
            position: absolute;
            bottom: 5px;
            right: 5px;
            font-size: 20px;
        }

        .frame-cherries::after {
            content: 'üçí';
            position: absolute;
            top: 5px;
            left: 5px;
            font-size: 20px;
        }
        .frame-cherries::before {
            content: 'üçí';
            position: absolute;
            bottom: 5px;
            right: 5px;
            font-size: 20px;
        }

        .frame-glitter {
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg"><rect width="100%" height="100%" fill="transparent" stroke="url(#glitter)" stroke-width="5"/><defs><linearGradient id="glitter" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#ff6f91;stop-opacity:1"/><stop offset="100%" style="stop-color:#ffd700;stop-opacity:1"/></linearGradient></defs></svg>');
            background-size: cover;
        }

        .frame-pawprints::after {
            content: 'üêæ';
            position: absolute;
            top: 5px;
            left: 5px;
            color: #da70d6;
            font-size: 20px;
        }
        .frame-pawprints::before {
            content: 'üêæ';
            position: absolute;
            bottom: 5px;
            right: 5px;
            color: #da70d6;
            font-size: 20px;
        }

        .frame-candy::after {
            content: 'üç¨';
            position: absolute;
            top: 5px;
            left: 5px;
            font-size: 20px;
        }
        .frame-candy::before {
            content: 'üç≠';
            position: absolute;
            bottom: 5px;
            right: 5px;
            font-size: 20px;
        }

        .frame-butterflies::after {
            content: 'ü¶ã';
            position: absolute;
            top: 5px;
            left: 5px;
            font-size: 20px;
        }
        .frame-butterflies::before {
            content: 'ü¶ã';
            position: absolute;
            bottom: 5px;
            right: 5px;
            font-size: 20px;
        }

        .frame-galaxy {
            background: radial-gradient(circle, #2b1055, #7597de);
        }

        .effect-btn,
        .layout-btn {
            background-color: #ffb6c1;
            border: none;
            padding: 5px 15px;
            border-radius: 15px;
            color: white;
            cursor: pointer;
        }

        .effect-btn:hover,
        .layout-btn:hover {
            background-color: #ff9cc7;
        }

        .polaroid-stack {
            position: relative;
            width: 220px;
            height: 220px;
            margin: -60px auto 0;
        }

        .polaroid-stack:first-child {
            margin-top: 20px;
        }

        /* Updated Color Picker Styles */
        .color-picker-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
            background: #ffb6c1;
            padding: 10px 20px;
            border-radius: 25px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .color-picker-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .color-picker-item label {
            color: #ffffff;
            font-family: 'Courier New', cursive;
            font-size: 1.1rem;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
            margin: 0;
        }

        .gradient-picker {
            display: flex;
            gap: 5px;
        }

        .gradient-picker input[type="color"] {
            width: 30px;
            height: 30px;
            border: 2px solid #ffffff;
            border-radius: 50%;
            padding: 0;
            cursor: pointer;
        }

        #solid-color-picker {
            width: 40px;
            height: 40px;
            border: 2px solid #ffffff;
            border-radius: 50%;
            padding: 0;
            cursor: pointer;
        }

        #solid-color-picker:hover,
        .gradient-picker input[type="color"]:hover {
            transform: scale(1.1);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        /* Watermark Input Styles */
        .watermark-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .watermark-container label {
            color: #ff6f91;
            font-family: 'Courier New', cursive;
            font-size: 1.1rem;
            font-weight: bold;
        }

        #watermark-input {
            padding: 5px 10px;
            border: 2px solid #ff6f91;
            border-radius: 15px;
            font-size: 1rem;
            width: 200px;
            outline: none;
        }

        @media (max-width: 768px) {
            .row { flex-direction: column; }
            #camera-container, #photo-container { padding: 10px; }
            video { width: 100%; height: auto; }
            .photo-frame { width: 150px; height: 150px; }
            .polaroid-stack { width: 165px; height: 165px; margin: -45px auto 0; }
            .polaroid-stack:first-child { margin-top: 15px; }
            h2 { font-size: 1.5rem; }
            p { font-size: 0.95rem; }
            .btn-custom { font-size: 0.95rem; padding: 8px 20px; min-width: 120px; }
            .frame, .background-option { width: 40px; height: 40px; margin: 4px; }
            .frame-container, .effect-container, .layout-container, .background-container { gap: 8px; }
            #countdown { font-size: 1.8rem; padding: 15px 20px; }
            .color-picker-container { gap: 10px; padding: 8px 15px; }
            .color-picker-item label { font-size: 0.95rem; }
            #solid-color-picker { width: 35px; height: 35px; }
            .gradient-picker input[type="color"] { width: 25px; height: 25px; }
            #watermark-input { width: 150px; font-size: 0.9rem; }
        }

        @media (max-width: 576px) {
            .photo-frame { width: 120px; height: 120px; }
            .polaroid-stack { width: 132px; height: 132px; margin: -36px auto 0; }
            .polaroid-stack:first-child { margin-top: 10px; }
            h2 { font-size: 1.3rem; }
            p { font-size: 0.85rem; }
            .btn-custom { font-size: 0.85rem; padding: 6px 15px; min-width: 100px; }
            .frame, .background-option { width: 35px; height: 35px; margin: 3px; }
            .frame-container, .effect-container, .layout-container, .background-container { gap: 6px; }
            #countdown { font-size: 1.5rem; padding: 10px 15px; }
            .color-picker-container { flex-wrap: wrap; gap: 8px; padding: 6px 10px; }
            .color-picker-item label { font-size: 0.85rem; }
            #solid-color-picker { width: 30px; height: 30px; }
            .gradient-picker input[type="color"] { width: 20px; height: 20px; }
            #watermark-input { width: 120px; font-size: 0.8rem; }
        }
    </style>
</head>

<body class="container py-5">
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-light" style="background-color: #ffb6c1; border-radius: 25px; margin-bottom: 2rem;">
        <div class="container-fluid">
            <a class="navbar-brand" href="#" style="color: #ffffff; font-family: 'Courier New', cursive;">PhotoBooth</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#aboutModal" style="color: #ffffff;">About</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#privacyModal" style="color: #ffffff;">Privacy</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#featuresModal" style="color: #ffffff;">Features</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#tipsModal" style="color: #ffffff;">Tips & Tricks</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <h2 class="text-center mb-4">PhotoBooth<br><small style="font-size: 1rem;">Beta V 1.1</small></h2>
    <p class="text-center">You have a custom countdown for each shot‚Äîno retakes! This photobooth captures 4 pictures in a row, so strike your best pose and have fun!</p>
    <div id="setup-container" class="text-center">
        <button class="btn btn-custom mt-3" onclick="startCamera()" aria-label="Start Camera">
            Start Camera
            <img src="https://img.icons8.com/ios-filled/20/ffffff/camera.png" alt="">
        </button>
    </div>

    <div class="row mt-4">
        <div class="col-md-6 text-center" id="camera-container" style="display: none;">
            <label for="countdown-select" class="me-2">Countdown (seconds):</label>
            <select id="countdown-select" class="form-select d-inline-block w-auto mb-3" aria-label="Select countdown duration">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3" selected>3</option>
                <option value="4">4</option>
                <option value="5">5</option>
            </select>
            <p id="countdown" style="display: none;"></p>
            <video id="video" width="400" height="400" autoplay muted playsinline class="rounded"></video>
            <br>
            <button class="btn btn-danger mt-2 btn-custom" onclick="capturePhotos()" disabled id="captureBtn" aria-label="Capture Photos">
                Capture Photos
                <img src="https://img.icons8.com/ios-filled/20/ffffff/sparkling.png" alt="">
            </button>
            <button class="btn btn-flip mt-2 btn-custom" onclick="flipCamera()" id="flipBtn" aria-label="Flip Camera">
                Flip Camera
                <img src="https://img.icons8.com/ios-filled/20/ffffff/refresh.png" alt="">
            </button>
            <div id="effect-selection" class="mt-3" style="display: none;">
                <h4>Choose an Effect</h4>
                <div class="effect-container">
                    <button class="effect-btn" onclick="applyEffect('none')">None</button>
                    <button class="effect-btn" onclick="applyEffect('sepia(1)')">Sepia</button>
                    <button class="effect-btn" onclick="applyEffect('grayscale(1)')">B&W</button>
                    <button class="effect-btn" onclick="applyEffect('blur(2px)')">Blur</button>
                </div>
            </div>
        </div>
        <div class="col-md-6 text-center">
            <div id="photo-container"></div>
        </div>
    </div>

    <div id="frame-selection" class="text-center mt-4" style="display:none;">
        <h4>Select a Cute Frame</h4>
        <div class="color-picker-container">
            <div class="color-picker-item">
                <label for="solid-color-picker">Solid Color:</label>
                <input type="color" id="solid-color-picker" value="#ff6f91" onchange="selectFrame(event, this.value, 'solid')">
            </div>
            <div class="color-picker-item">
                <label>Gradient:</label>
                <div class="gradient-picker">
                    <input type="color" id="gradient-start" value="#ff6f91" onchange="selectGradientFrame()">
                    <input type="color" id="gradient-end" value="#ffd700" onchange="selectGradientFrame()">
                </div>
            </div>
        </div>
        <div class="watermark-container">
            <label for="watermark-input">Custom Watermark:</label>
            <input type="text" id="watermark-input" placeholder="Enter your text" value="">
        </div>
        <div class="frame-container">
            <!-- Existing Decorative Frames -->
            <div class="frame frame-white" onclick="selectFrame(event, '#ffffff', 'dashed')"></div>
            <div class="frame frame-stars" style="background-color: #ffffff;" onclick="selectFrame(event, '#ffffff', 'stars')"></div>
            <div class="frame frame-hearts" style="background-color: #ffb6c1;" onclick="selectFrame(event, '#ffb6c1', 'hearts')"></div>
            <div class="frame frame-sunflowers" style="background-color: #ffffff;" onclick="selectFrame(event, '#ffffff', 'sunflowers')"></div>
            <div class="frame frame-flowers" style="background-color: #ffffff;" onclick="selectFrame(event, '#ffffff', 'flowers')"></div>
            <div class="frame frame-bows" style="background-color: #ffffff;" onclick="selectFrame(event, '#ffffff', 'bows')"></div>
            <div class="frame frame-bunnies" style="background-color: #ffffff;" onclick="selectFrame(event, '#ffffff', 'bunnies')"></div>
            <div class="frame frame-waves" onclick="selectFrame(event, '#ff9cc7', 'waves')"></div>
            <div class="frame frame-clouds" style="background-color: #ffffff;" onclick="selectFrame(event, '#ffffff', 'clouds')"></div>
            <div class="frame frame-cats" style="background-color: #ffffff;" onclick="selectFrame(event, '#ffffff', 'cats')"></div>
        </div>
        <div class="frame-container">
            <!-- 10 New Frames -->
            <div class="frame frame-pusheen" style="background-color: #ffb6c1;" onclick="selectFrame(event, '#ffb6c1', 'pusheen')"></div>
            <div class="frame frame-rainbow" onclick="selectFrame(event, 'linear-gradient(90deg, #ff6f61, #ffd700, #ff69b4, #87ceeb)', 'rainbow')"></div>
            <div class="frame frame-diamonds" style="background-color: #ffffff;" onclick="selectFrame(event, '#ffffff', 'diamonds')"></div>
            <div class="frame frame-moon" style="background-color: #87ceeb;" onclick="selectFrame(event, '#87ceeb', 'moon')"></div>
            <div class="frame frame-cherries" style="background-color: #ff6f61;" onclick="selectFrame(event, '#ff6f61', 'cherries')"></div>
            <div class="frame frame-glitter" onclick="selectFrame(event, '#ff6f91', 'glitter')"></div>
            <div class="frame frame-pawprints" style="background-color: #da70d6;" onclick="selectFrame(event, '#da70d6', 'pawprints')"></div>
            <div class="frame frame-candy" style="background-color: #ffc0cb;" onclick="selectFrame(event, '#ffc0cb', 'candy')"></div>
            <div class="frame frame-butterflies" style="background-color: #ffa07a;" onclick="selectFrame(event, '#ffa07a', 'butterflies')"></div>
            <div class="frame frame-galaxy" onclick="selectFrame(event, 'radial-gradient(circle, #2b1055, #7597de)', 'galaxy')"></div>
        </div>
    </div>

    <div id="layout-selection" class="text-center mt-4" style="display:none;">
        <h4>Choose a Layout</h4>
        <div class="layout-container">
            <button class="layout-btn selected" data-layout="vertical" onclick="selectLayout('vertical')">Vertical Strip</button>
            <button class="layout-btn" data-layout="grid" onclick="selectLayout('grid')">2x2 Grid</button>
            <button class="layout-btn" data-layout="polaroid" onclick="selectLayout('polaroid')">Polaroid Stack</button>
        </div>
    </div>

    <div id="background-selection" class="text-center mt-4" style="display:none;">
        <h4>Swap Background</h4>
        <div class="background-container">
            <div class="background-option" style="background-color: #87CEEB;" onclick="selectBackground('solid', '#87CEEB')" title="Sky Blue"></div>
            <div class="background-option" style="background: url('https://images.unsplash.com/photo-1506748686214-e9df14d4d9d0?auto=format&fit=crop&w=50&h=50')" onclick="selectBackground('image', 'https://images.unsplash.com/photo-1506748686214-e9df14d4d9d0')" title="Beach"></div>
            <div class="background-option" style="background: url('https://images.unsplash.com/photo-1534796636912-3b95b3ab5986?auto=format&fit=crop&w=50&h=50')" onclick="selectBackground('image', 'https://images.unsplash.com/photo-1534796636912-3b95b3ab5986')" title="Stars"></div>
            <label class="background-option" style="background-color: #fff; border: 2px dashed #ff6f91; display: flex; align-items: center; justify-content: center;">
                <input type="file" accept="image/*" onchange="uploadBackground(event)" style="display: none;" aria-label="Upload custom background">
                <span>+</span>
            </label>
        </div>
    </div>

    <div class="text-center mt-4" style="display:none;" id="action-buttons">
        <button class="btn btn-danger mt-3 btn-custom" onclick="retakePhotos()" aria-label="Retake Photos">
            Retake Photos
            <img src="https://img.icons8.com/ios-filled/20/ffffff/available-updates.png" alt="">
        </button>
        <button class="btn btn-custom mt-3" onclick="sharePhotos()" aria-label="Share Photos">
            Share Photos
            <img src="https://img.icons8.com/ios-filled/20/ffffff/share.png" alt="">
        </button>
        <button class="btn btn-success mt-3 btn-custom" onclick="downloadPhotos()" aria-label="Save Photos">
            Save Photos
            <img src="https://img.icons8.com/ios-filled/20/ff6f91/download.png" alt="">
        </button>
    </div>

    <!-- Modals -->
    <!-- About Modal -->
    <div class="modal fade" id="aboutModal" tabindex="-1" aria-labelledby="aboutModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="aboutModalLabel">About PhotoBooth</h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>PhotoBooth is a fun, interactive web application that lets you capture memorable moments with cute frames and effects. Created with love by Arkar Yan, it's perfect for creating instant photo strips to share with friends!</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-custom" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Privacy Modal -->
    <div class="modal fade" id="privacyModal" tabindex="-1" aria-labelledby="privacyModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="privacyModalLabel">Privacy</h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>We value your privacy! Photos are processed locally in your browser and only stored if you choose to save or share them. No personal camera data is collected without your consent.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-custom" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Features Modal -->
    <div class="modal fade" id="featuresModal" tabindex="-1" aria-labelledby="featuresModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="featuresModalLabel">Features</h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <ul>
                        <li>4-photo capture sequence with custom countdown</li>
                        <li>Multiple layout options (Vertical, Grid, Polaroid)</li>
                        <li>Cute frames and effects</li>
                        <li>Background customization</li>
                        <li>Share and download functionality</li>
                    </ul>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-custom" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Tips & Tricks Modal -->
    <div class="modal fade" id="tipsModal" tabindex="-1" aria-labelledby="tipsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="tipsModalLabel">Tips & Tricks</h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <ul>
                        <li>Use good lighting for best results</li>
                        <li>Try different frames with matching backgrounds</li>
                        <li>Experiment with effects before capturing</li>
                        <li>Share directly using the share button on mobile</li>
                        <li>Adjust countdown timing for perfect poses</li>
                    </ul>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-custom" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let selectedFrame = '';
        let selectedFrameStyle = '';
        let gradientStart = '#ff6f91';
        let gradientEnd = '#ffd700';
        let currentEffect = 'none';
        let selectedLayout = 'vertical';
        let selectedBackgroundType = null;
        let selectedBackgroundValue = null;
        let backgroundImage = null;
        let finalCanvasData = null;
        const photoCount = 4;
        let videoStream = null;
        let isCapturing = false;
        let facingMode = 'user';
        let fullResImages = [];

        async function startCamera() {
            try {
                if (videoStream) {
                    videoStream.getTracks().forEach(track => track.stop());
                }
                videoStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: facingMode } });
                const video = document.getElementById('video');
                video.srcObject = videoStream;
                video.style.filter = currentEffect;
                document.getElementById('setup-container').style.display = 'none';
                document.getElementById('camera-container').style.display = 'block';
                document.getElementById('effect-selection').style.display = 'block';
                document.getElementById('captureBtn').disabled = false;
            } catch (err) {
                console.error('Camera access failed:', err);
                alert('Failed to access camera: ' + err.message);
            }
        }

        async function flipCamera() {
            facingMode = facingMode === 'user' ? 'environment' : 'user';
            await startCamera();
        }

        function applyEffect(effect) {
            currentEffect = effect;
            const video = document.getElementById('video');
            video.style.filter = effect;
            document.querySelectorAll('.effect-btn').forEach(btn => btn.classList.remove('selected'));
            event.target.classList.add('selected');
            redrawPhotos();
        }

        async function capturePhotos() {
            if (isCapturing) return;
            isCapturing = true;
            const captureBtn = document.getElementById('captureBtn');
            captureBtn.disabled = true;

            const countdownDuration = parseInt(document.getElementById('countdown-select').value);
            let countdown = countdownDuration;
            const countdownElement = document.getElementById('countdown');
            countdownElement.style.display = 'block';
            countdownElement.innerText = `Ready? ${countdown}`;

            await new Promise(resolve => {
                const interval = setInterval(() => {
                    countdown--;
                    countdownElement.innerText = countdown > 0 ? countdown : 'Smile!';
                    if (countdown <= 0) {
                        clearInterval(interval);
                        resolve();
                    }
                }, 1000);
            });

            countdownElement.style.display = 'none';
            await takePhotos(countdownDuration);
            captureBtn.disabled = false;
            isCapturing = false;
        }

        async function takePhotos(countdownDuration) {
            const video = document.getElementById('video');
            const photoContainer = document.getElementById('photo-container');
            const countdownElement = document.getElementById('countdown');
            photoContainer.innerHTML = '';
            fullResImages = [];

            for (let i = 0; i < photoCount; i++) {
                countdownElement.style.display = 'block';
                let photoCountdown = countdownDuration;

                await new Promise(resolve => {
                    countdownElement.innerText = `${i + 1}/${photoCount}: ${photoCountdown}`;
                    const interval = setInterval(() => {
                        photoCountdown--;
                        countdownElement.innerText = `${i + 1}/${photoCount}: ${photoCountdown}`;
                        if (photoCountdown <= 0) {
                            clearInterval(interval);
                            resolve();
                        }
                    }, 1000);
                });

                countdownElement.style.display = 'none';

                const canvas = document.createElement('canvas');
                canvas.width = 200;
                canvas.height = 200;
                const ctx = canvas.getContext('2d');

                ctx.filter = currentEffect;
                ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                ctx.filter = 'none';

                const imgData = canvas.toDataURL('image/png');
                fullResImages.push(imgData);

                const img = document.createElement('img');
                img.src = imgData;
                img.classList.add('photo-frame');
                img.dataset.index = i;
                photoContainer.appendChild(img);
            }

            document.getElementById('frame-selection').style.display = 'block';
            document.getElementById('layout-selection').style.display = 'block';
            document.getElementById('action-buttons').style.display = 'block';
            document.getElementById('effect-selection').style.display = 'none';
        }

        function applyFrameStyleToCanvas(ctx, x, y, width, height) {
            if (selectedFrame) {
                const frameThickness = 5;
                const innerX = x + frameThickness;
                const innerY = y + frameThickness;
                const innerWidth = width - frameThickness * 2;
                const innerHeight = height - frameThickness * 2;
                const stickerOffset = 15; // Increased from 10 to 15 for more spacing
        
                // Draw the frame border
                if (selectedFrameStyle === 'dashed') {
                    ctx.setLineDash([10, 5]);
                    ctx.strokeStyle = '#ff6f91';
                    ctx.lineWidth = frameThickness * 2;
                    ctx.strokeRect(innerX, innerY, innerWidth, innerHeight);
                    ctx.setLineDash([]);
                } else if (selectedFrameStyle === 'stars') {
                    ctx.strokeStyle = '#ff6f91';
                    ctx.lineWidth = frameThickness * 2;
                    ctx.strokeRect(innerX, innerY, innerWidth, innerHeight);
                    ctx.fillStyle = '#ff6f91';
                    ctx.font = '20px Arial';
                    ctx.fillText('‚òÖ', innerX + stickerOffset, innerY + 20); // Left sticker
                    ctx.fillText('‚òÖ', innerX + innerWidth - stickerOffset - 15, innerY + innerHeight - stickerOffset); // Right sticker, moved left
                } else if (selectedFrameStyle === 'hearts') {
                    ctx.strokeStyle = '#ff69b4';
                    ctx.lineWidth = frameThickness * 2;
                    ctx.strokeRect(innerX, innerY, innerWidth, innerHeight);
                    ctx.fillStyle = '#ff69b4';
                    ctx.font = '20px Arial';
                    ctx.fillText('‚ô•', innerX + stickerOffset, innerY + 20);
                    ctx.fillText('‚ô•', innerX + innerWidth - stickerOffset - 15, innerY + innerHeight - stickerOffset);
                } else if (selectedFrameStyle === 'sunflowers') {
                    ctx.strokeStyle = '#FFD700';
                    ctx.lineWidth = frameThickness * 2;
                    ctx.strokeRect(innerX, innerY, innerWidth, innerHeight);
                    ctx.fillStyle = '#FFD700';
                    ctx.font = '20px Arial';
                    ctx.fillText('üåª', innerX + stickerOffset, innerY + 20);
                    ctx.fillText('üåª', innerX + innerWidth - stickerOffset - 15, innerY + innerHeight - stickerOffset);
                } else if (selectedFrameStyle === 'flowers') {
                    ctx.strokeStyle = '#ff9cc7';
                    ctx.lineWidth = frameThickness * 2;
                    ctx.strokeRect(innerX, innerY, innerWidth, innerHeight);
                    ctx.fillStyle = '#ff9cc7';
                    ctx.font = '20px Arial';
                    ctx.fillText('‚ùÄ', innerX + stickerOffset, innerY + 20);
                    ctx.fillText('‚ùÄ', innerX + innerWidth - stickerOffset - 15, innerY + innerHeight - stickerOffset);
                } else if (selectedFrameStyle === 'bows') {
                    ctx.strokeStyle = '#ff69b4';
                    ctx.lineWidth = frameThickness * 2;
                    ctx.strokeRect(innerX, innerY, innerWidth, innerHeight);
                    ctx.fillStyle = '#ff69b4';
                    ctx.font = '20px Arial';
                    ctx.fillText('üéÄ', innerX + stickerOffset, innerY + 20);
                    ctx.fillText('üéÄ', innerX + innerWidth - stickerOffset - 15, innerY + innerHeight - stickerOffset);
                } else if (selectedFrameStyle === 'bunnies') {
                    ctx.strokeStyle = '#ffb6c1';
                    ctx.lineWidth = frameThickness * 2;
                    ctx.strokeRect(innerX, innerY, innerWidth, innerHeight);
                    ctx.fillStyle = '#ffb6c1';
                    ctx.font = '20px Arial';
                    ctx.fillText('üê∞', innerX + stickerOffset, innerY + 20);
                    ctx.fillText('üê∞', innerX + innerWidth - stickerOffset - 15, innerY + innerHeight - stickerOffset);
                } else if (selectedFrameStyle === 'waves') {
                    ctx.strokeStyle = '#ff9cc7';
                    ctx.lineWidth = frameThickness * 2;
                    ctx.strokeRect(innerX, innerY, innerWidth, innerHeight);
                    ctx.beginPath();
                    ctx.moveTo(innerX + frameThickness, innerY + 20);
                    ctx.quadraticCurveTo(innerX + innerWidth / 2, innerY - 10, innerX + innerWidth - frameThickness, innerY + 20);
                    ctx.stroke();
                } else if (selectedFrameStyle === 'clouds') {
                    ctx.strokeStyle = '#c3e6fc';
                    ctx.lineWidth = frameThickness * 2;
                    ctx.strokeRect(innerX, innerY, innerWidth, innerHeight);
                    ctx.fillStyle = '#c3e6fc';
                    ctx.font = '20px Arial';
                    ctx.fillText('‚òÅ', innerX + stickerOffset, innerY + 20);
                    ctx.fillText('‚òÅ', innerX + innerWidth - stickerOffset - 15, innerY + innerHeight - stickerOffset);
                } else if (selectedFrameStyle === 'cats') {
                    ctx.strokeStyle = '#ff6f91';
                    ctx.lineWidth = frameThickness * 2;
                    ctx.strokeRect(innerX, innerY, innerWidth, innerHeight);
                    ctx.fillStyle = '#ff6f91';
                    ctx.font = '20px Arial';
                    ctx.fillText('üêæ', innerX + stickerOffset, innerY + 20);
                    ctx.fillText('üêæ', innerX + innerWidth - stickerOffset - 15, innerY + innerHeight - stickerOffset);
                } else if (selectedFrameStyle === 'pusheen') {
                    ctx.strokeStyle = '#ffb6c1';
                    ctx.lineWidth = frameThickness * 2;
                    ctx.strokeRect(innerX, innerY, innerWidth, innerHeight);
                    ctx.fillStyle = '#ffb6c1';
                    ctx.font = '20px Arial';
                    ctx.fillText('üê±', innerX + stickerOffset, innerY + 20);
                    ctx.fillText('üçî', innerX + innerWidth - stickerOffset - 15, innerY + innerHeight - stickerOffset);
                } else if (selectedFrameStyle === 'rainbow') {
                    const gradient = ctx.createLinearGradient(innerX, innerY, innerX + innerWidth, innerY + innerHeight);
                    gradient.addColorStop(0, '#ff6f61');
                    gradient.addColorStop(0.33, '#ffd700');
                    gradient.addColorStop(0.66, '#ff69b4');
                    gradient.addColorStop(1, '#87ceeb');
                    ctx.strokeStyle = gradient;
                    ctx.lineWidth = frameThickness * 2;
                    ctx.strokeRect(innerX, innerY, innerWidth, innerHeight);
                } else if (selectedFrameStyle === 'diamonds') {
                    ctx.strokeStyle = '#ff6f91';
                    ctx.lineWidth = frameThickness * 2;
                    ctx.strokeRect(innerX, innerY, innerWidth, innerHeight);
                    ctx.fillStyle = '#ff6f91';
                    ctx.font = '20px Arial';
                    ctx.fillText('‚ô¶', innerX + stickerOffset, innerY + 20);
                    ctx.fillText('‚ô¶', innerX + innerWidth - stickerOffset - 15, innerY + innerHeight - stickerOffset);
                } else if (selectedFrameStyle === 'moon') {
                    ctx.strokeStyle = '#87ceeb';
                    ctx.lineWidth = frameThickness * 2;
                    ctx.strokeRect(innerX, innerY, innerWidth, innerHeight);
                    ctx.fillStyle = '#87ceeb';
                    ctx.font = '20px Arial';
                    ctx.fillText('üåô', innerX + stickerOffset, innerY + 20);
                    ctx.fillText('‚ú®', innerX + innerWidth - stickerOffset - 15, innerY + innerHeight - stickerOffset);
                } else if (selectedFrameStyle === 'cherries') {
                    ctx.strokeStyle = '#ff6f61';
                    ctx.lineWidth = frameThickness * 2;
                    ctx.strokeRect(innerX, innerY, innerWidth, innerHeight);
                    ctx.fillStyle = '#ff6f61';
                    ctx.font = '20px Arial';
                    ctx.fillText('üçí', innerX + stickerOffset, innerY + 20);
                    ctx.fillText('üçí', innerX + innerWidth - stickerOffset - 15, innerY + innerHeight - stickerOffset);
                } else if (selectedFrameStyle === 'glitter') {
                    const gradient = ctx.createLinearGradient(innerX, innerY, innerX + innerWidth, innerY + innerHeight);
                    gradient.addColorStop(0, '#ff6f91');
                    gradient.addColorStop(1, '#ffd700');
                    ctx.strokeStyle = gradient;
                    ctx.lineWidth = frameThickness * 2;
                    ctx.strokeRect(innerX, innerY, innerWidth, innerHeight);
                } else if (selectedFrameStyle === 'pawprints') {
                    ctx.strokeStyle = '#da70d6';
                    ctx.lineWidth = frameThickness * 2;
                    ctx.strokeRect(innerX, innerY, innerWidth, innerHeight);
                    ctx.fillStyle = '#da70d6';
                    ctx.font = '20px Arial';
                    ctx.fillText('üêæ', innerX + stickerOffset, innerY + 20);
                    ctx.fillText('üêæ', innerX + innerWidth - stickerOffset - 15, innerY + innerHeight - stickerOffset);
                } else if (selectedFrameStyle === 'candy') {
                    ctx.strokeStyle = '#ffc0cb';
                    ctx.lineWidth = frameThickness * 2;
                    ctx.strokeRect(innerX, innerY, innerWidth, innerHeight);
                    ctx.fillStyle = '#ffc0cb';
                    ctx.font = '20px Arial';
                    ctx.fillText('üç¨', innerX + stickerOffset, innerY + 20);
                    ctx.fillText('üç≠', innerX + innerWidth - stickerOffset - 15, innerY + innerHeight - stickerOffset);
                } else if (selectedFrameStyle === 'butterflies') {
                    ctx.strokeStyle = '#ffa07a';
                    ctx.lineWidth = frameThickness * 2;
                    ctx.strokeRect(innerX, innerY, innerWidth, innerHeight);
                    ctx.fillStyle = '#ffa07a';
                    ctx.font = '20px Arial';
                    ctx.fillText('ü¶ã', innerX + stickerOffset, innerY + 20);
                    ctx.fillText('ü¶ã', innerX + innerWidth - stickerOffset - 15, innerY + innerHeight - stickerOffset);
                } else if (selectedFrameStyle === 'galaxy') {
                    const gradient = ctx.createRadialGradient(innerX + innerWidth / 2, innerY + innerHeight / 2, 0, innerX + innerWidth / 2, innerY + innerHeight / 2, innerWidth / 2);
                    gradient.addColorStop(0, '#2b1055');
                    gradient.addColorStop(1, '#7597de');
                    ctx.strokeStyle = gradient;
                    ctx.lineWidth = frameThickness * 2;
                    ctx.strokeRect(innerX, innerY, innerWidth, innerHeight);
                } else if (selectedFrameStyle === 'gradient') {
                    const gradient = ctx.createLinearGradient(innerX, innerY, innerX + innerWidth, innerY + innerHeight);
                    gradient.addColorStop(0, gradientStart);
                    gradient.addColorStop(1, gradientEnd);
                    ctx.strokeStyle = gradient;
                    ctx.lineWidth = frameThickness * 2;
                    ctx.strokeRect(innerX, innerY, innerWidth, innerHeight);
                } else if (selectedFrameStyle === 'solid') {
                    ctx.strokeStyle = selectedFrame;
                    ctx.lineWidth = frameThickness * 2;
                    ctx.strokeRect(innerX, innerY, innerWidth, innerHeight);
                } else {
                    ctx.strokeStyle = selectedFrame;
                    ctx.lineWidth = frameThickness * 2;
                    ctx.strokeRect(innerX, innerY, innerWidth, innerHeight);
                }
            }
        }

        function selectFrame(event, frameColor, style = '') {
            event.preventDefault();
            selectedFrame = frameColor;
            selectedFrameStyle = style;
            const frames = document.querySelectorAll('.frame');
            frames.forEach(frame => frame.classList.remove('selected'));
            if (style !== 'solid' && style !== 'gradient') {
                event.target.classList.add('selected');
            }
            updateFrames();
        }

        function selectGradientFrame() {
            gradientStart = document.getElementById('gradient-start').value;
            gradientEnd = document.getElementById('gradient-end').value;
            selectedFrame = `linear-gradient(90deg, ${gradientStart}, ${gradientEnd})`;
            selectedFrameStyle = 'gradient';
            const frames = document.querySelectorAll('.frame');
            frames.forEach(frame => frame.classList.remove('selected'));
            updateFrames();
        }

        function selectLayout(layout) {
            selectedLayout = layout;
            const buttons = document.querySelectorAll('.layout-btn');
            buttons.forEach(btn => btn.classList.remove('selected'));
            document.querySelector(`[data-layout="${layout}"]`).classList.add('selected');
            document.getElementById('background-selection').style.display = layout === 'polaroid' ? 'block' : 'none';
            if (layout !== 'polaroid') {
                selectedBackgroundType = null;
                selectedBackgroundValue = null;
                backgroundImage = null;
            }
            redrawPhotos();
        }

        function selectBackground(type, value) {
            if (selectedLayout !== 'polaroid') return;
            selectedBackgroundType = type;
            selectedBackgroundValue = value;
            const options = document.querySelectorAll('.background-option');
            options.forEach(opt => opt.classList.remove('selected'));
            event.target.classList.add('selected');

            if (type === 'image') {
                backgroundImage = new Image();
                backgroundImage.crossOrigin = 'anonymous';
                backgroundImage.src = value;
                backgroundImage.onload = () => redrawPhotos();
                backgroundImage.onerror = () => console.error('Failed to load background image:', value);
            } else {
                backgroundImage = null;
                redrawPhotos();
            }
        }

        function uploadBackground(event) {
            if (selectedLayout !== 'polaroid') return;
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    selectedBackgroundType = 'image';
                    selectedBackgroundValue = e.target.result;
                    backgroundImage = new Image();
                    backgroundImage.crossOrigin = 'anonymous';
                    backgroundImage.src = selectedBackgroundValue;
                    backgroundImage.onload = () => {
                        const options = document.querySelectorAll('.background-option');
                        options.forEach(opt => opt.classList.remove('selected'));
                        event.target.parentElement.classList.add('selected');
                        redrawPhotos();
                    };
                    backgroundImage.onerror = () => console.error('Failed to load uploaded background');
                };
                reader.readAsDataURL(file);
            }
        }

        function redrawPhotos() {
            const photoContainer = document.getElementById('photo-container');
            photoContainer.innerHTML = '';
            const fragment = document.createDocumentFragment();

            fullResImages.forEach((imgData, index) => {
                const canvas = document.createElement('canvas');
                canvas.width = 200;
                canvas.height = 200;
                const ctx = canvas.getContext('2d');

                const img = new Image();
                img.src = imgData;
                img.onload = () => {
                    ctx.filter = currentEffect;
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                    ctx.filter = 'none';
                    applyFrameStyleToCanvas(ctx, 0, 0, canvas.width, canvas.height);

                    const newImg = document.createElement('img');
                    newImg.src = canvas.toDataURL('image/png');
                    newImg.classList.add('photo-frame');
                    newImg.dataset.index = index;
                    fragment.appendChild(newImg);

                    if (index === fullResImages.length - 1) {
                        if (selectedLayout === 'vertical') {
                            photoContainer.appendChild(fragment);
                        } else if (selectedLayout === 'grid') {
                            const gridDiv = document.createElement('div');
                            gridDiv.style.display = 'grid';
                            gridDiv.style.gridTemplateColumns = '1fr 1fr';
                            gridDiv.style.gap = '10px';
                            Array.from(fragment.children).forEach(img => gridDiv.appendChild(img));
                            photoContainer.appendChild(gridDiv);
                        } else if (selectedLayout === 'polaroid') {
                            Array.from(fragment.children).forEach((img, i) => {
                                const polaroidDiv = document.createElement('div');
                                polaroidDiv.classList.add('polaroid-stack');
                                polaroidDiv.style.transform = `rotate(${i * 5 - 7.5}deg)`;
                                polaroidDiv.appendChild(img);
                                photoContainer.appendChild(polaroidDiv);
                            });
                        }
                    }
                };
                img.onerror = () => console.error('Failed to load image:', imgData);
            });
        }

        function updateFrames() {
            const photoContainer = document.getElementById('photo-container');
            const existingImages = photoContainer.querySelectorAll('.photo-frame');

            fullResImages.forEach((imgData, index) => {
                const canvas = document.createElement('canvas');
                canvas.width = 200;
                canvas.height = 200;
                const ctx = canvas.getContext('2d');

                const img = new Image();
                img.src = imgData;
                img.onload = () => {
                    ctx.filter = currentEffect;
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                    ctx.filter = 'none';
                    applyFrameStyleToCanvas(ctx, 0, 0, canvas.width, canvas.height);

                    const existingImg = existingImages[index];
                    if (existingImg) {
                        existingImg.src = canvas.toDataURL('image/png');
                    }
                };
                img.onerror = () => console.error('Failed to load image for frame update:', imgData);
            });
        }

        function retakePhotos() {
            const photoContainer = document.getElementById('photo-container');
            photoContainer.innerHTML = '';
            fullResImages = [];
            document.getElementById('frame-selection').style.display = 'none';
            document.getElementById('layout-selection').style.display = 'none';
            document.getElementById('background-selection').style.display = 'none';
            document.getElementById('action-buttons').style.display = 'none';
            document.getElementById('effect-selection').style.display = 'block';
            document.getElementById('captureBtn').disabled = false;
            isCapturing = false;
            startCamera();
        }

        function downloadPhotos() {
            const images = fullResImages;
            if (images.length === 0) {
                alert('No photos to download!');
                return;
            }
        
            const imgWidth = 200;
            const imgHeight = 200;
            const frameThickness = 2; // Thinner frames
            const bottomFrameThickness = 60;
        
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
        
            // Get custom watermark text, fixed URL, and date/time
            const customWatermark = document.getElementById('watermark-input').value || '';
            const fixedURL = 'https://www.hidecard.info/photobooth/';
            const currentDateTime = new Date().toLocaleString(); // e.g., "3/3/2025, 12:00:00 PM"
        
            if (selectedLayout === 'vertical') {
                // Canvas tightly fits images with frames between them
                canvas.width = imgWidth; // No extra padding on sides
                canvas.height = (imgHeight * images.length) + (frameThickness * (images.length - 1)) + bottomFrameThickness;
        
                // Fill canvas background with #fce7f3
                ctx.fillStyle = '#fce7f3';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
        
                let y = 0; // Start at top with no padding
                const imageObjects = images.map(src => {
                    const image = new Image();
                    image.crossOrigin = 'anonymous';
                    image.src = src;
                    return image;
                });
        
                Promise.all(imageObjects.map(img => new Promise(resolve => { img.onload = resolve; img.onerror = resolve; })))
                    .then(() => {
                        imageObjects.forEach((image, index) => {
                            ctx.filter = currentEffect;
                            ctx.drawImage(image, 0, y, imgWidth, imgHeight);
                            ctx.filter = 'none';
                            applyFrameStyleToCanvas(ctx, 0, y, imgWidth, imgHeight); // Frame for each image
        
                            if (index === images.length - 1 && selectedFrame) {
                                ctx.lineWidth = bottomFrameThickness * 2;
                                ctx.strokeStyle = selectedFrameStyle === 'gradient' ? '#ff6f91' : (selectedFrameStyle ? '#ff6f91' : selectedFrame);
                                ctx.beginPath();
                                ctx.moveTo(0, canvas.height);
                                ctx.lineTo(canvas.width, canvas.height);
                                ctx.stroke();
        
                                // Bottom Watermark
                                ctx.fillStyle = 'white';
                                ctx.textAlign = 'center';
                                ctx.textBaseline = 'middle';
        
                                if (customWatermark) {
                                    ctx.font = '15px Arial';
                                    ctx.fillText(customWatermark, canvas.width / 2, canvas.height - 40);
                                }
        
                                ctx.font = '10px Arial';
                                ctx.fillText(currentDateTime, canvas.width / 2, canvas.height - 25);
        
                                ctx.font = '8px Arial';
                                ctx.fillText(fixedURL, canvas.width / 2, canvas.height - 10);
                            }
                            y += imgHeight + (index < images.length - 1 ? frameThickness : 0); // Frame only between images
                        });
        
                        finalCanvasData = canvas.toDataURL('image/png');
                        const link = document.createElement('a');
                        link.href = finalCanvasData;
                        link.download = `photobooth_${Date.now()}.png`;
                        link.click();
                    })
                    .catch(err => console.error('Error processing images for download:', err));
            } else if (selectedLayout === 'grid') {
                // Canvas tightly fits 2x2 grid with frames between images
                canvas.width = (imgWidth * 2) + frameThickness; // Frame between columns
                canvas.height = (imgHeight * 2) + frameThickness + bottomFrameThickness; // Frame between rows
        
                // Fill canvas background with #fce7f3
                ctx.fillStyle = '#fce7f3';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
        
                const imageObjects = images.map(src => {
                    const image = new Image();
                    image.crossOrigin = 'anonymous';
                    image.src = src;
                    return image;
                });
        
                Promise.all(imageObjects.map(img => new Promise(resolve => { img.onload = resolve; img.onerror = resolve; })))
                    .then(() => {
                        const positions = [
                            { x: 0, y: 0 }, // Top-left
                            { x: imgWidth + frameThickness, y: 0 }, // Top-right
                            { x: 0, y: imgHeight + frameThickness }, // Bottom-left
                            { x: imgWidth + frameThickness, y: imgHeight + frameThickness } // Bottom-right
                        ];
        
                        imageObjects.forEach((image, index) => {
                            const { x, y } = positions[index];
                            ctx.filter = currentEffect;
                            ctx.drawImage(image, x, y, imgWidth, imgHeight);
                            ctx.filter = 'none';
                            applyFrameStyleToCanvas(ctx, x, y, imgWidth, imgHeight); // Frame for each image
        
                            if (index === images.length - 1 && selectedFrame) {
                                ctx.lineWidth = bottomFrameThickness * 2;
                                ctx.strokeStyle = selectedFrameStyle === 'gradient' ? '#ff6f91' : (selectedFrameStyle ? '#ff6f91' : selectedFrame);
                                ctx.beginPath();
                                ctx.moveTo(0, canvas.height);
                                ctx.lineTo(canvas.width, canvas.height);
                                ctx.stroke();
        
                                // Bottom Watermark
                                ctx.fillStyle = 'white';
                                ctx.textAlign = 'center';
                                ctx.textBaseline = 'middle';
        
                                if (customWatermark) {
                                    ctx.font = '15px Arial';
                                    ctx.fillText(customWatermark, canvas.width / 2, canvas.height - 40);
                                }
        
                                ctx.font = '10px Arial';
                                ctx.fillText(currentDateTime, canvas.width / 2, canvas.height - 25);
        
                                ctx.font = '8px Arial';
                                ctx.fillText(fixedURL, canvas.width / 2, canvas.height - 10);
                            }
                        });
        
                        finalCanvasData = canvas.toDataURL('image/png');
                        const link = document.createElement('a');
                        link.href = finalCanvasData;
                        link.download = `photobooth_${Date.now()}.png`;
                        link.click();
                    })
                    .catch(err => console.error('Error processing grid layout:', err));
            } else if (selectedLayout === 'polaroid') {
                canvas.width = imgWidth + (frameThickness * 4) + 40;
                canvas.height = imgHeight + bottomFrameThickness + 480;
        
                if (selectedBackgroundType === 'solid') {
                    ctx.fillStyle = selectedBackgroundValue;
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                } else if (selectedBackgroundType === 'image' && backgroundImage) {
                    ctx.drawImage(backgroundImage, 0, 0, canvas.width, canvas.height);
                } else {
                    ctx.fillStyle = '#fce7f3';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                }
        
                const imageObjects = images.map(src => {
                    const image = new Image();
                    image.crossOrigin = 'anonymous';
                    image.src = src;
                    return image;
                });
        
                Promise.all(imageObjects.map(img => new Promise(resolve => { img.onload = resolve; img.onerror = resolve; })))
                    .then(() => {
                        let y = frameThickness;
                        imageObjects.forEach((image, index) => {
                            const tiltAngle = (index * 5 - 7.5) * Math.PI / 180;
                            ctx.save();
                            ctx.translate(canvas.width / 2, y + (imgHeight / 2));
                            ctx.rotate(tiltAngle);
        
                            ctx.filter = currentEffect;
                            ctx.drawImage(image, -imgWidth / 2, -imgHeight / 2, imgWidth, imgHeight);
                            ctx.filter = 'none';
                            applyFrameStyleToCanvas(ctx, -imgWidth / 2, -imgHeight / 2, imgWidth, imgHeight);
                            ctx.restore();
        
                            if (index === images.length - 1 && selectedFrame) {
                                ctx.lineWidth = bottomFrameThickness * 2;
                                ctx.strokeStyle = selectedFrameStyle === 'gradient' ? '#ff6f91' : (selectedFrameStyle ? '#ff6f91' : selectedFrame);
                                ctx.beginPath();
                                ctx.moveTo(0, canvas.height);
                                ctx.lineTo(canvas.width, canvas.height);
                                ctx.stroke();
        
                                ctx.fillStyle = 'white';
                                ctx.textAlign = 'center';
                                ctx.textBaseline = 'middle';
        
                                if (customWatermark) {
                                    ctx.font = '15px Arial';
                                    ctx.fillText(customWatermark, canvas.width / 2, canvas.height - 40);
                                }
        
                                ctx.font = '10px Arial';
                                ctx.fillText(currentDateTime, canvas.width / 2, canvas.height - 25);
        
                                ctx.font = '8px Arial';
                                ctx.fillText(fixedURL, canvas.width / 2, canvas.height - 10);
                            }
                            y += 160;
                        });
        
                        finalCanvasData = canvas.toDataURL('image/png');
                        const link = document.createElement('a');
                        link.href = finalCanvasData;
                        link.download = `photobooth_${Date.now()}.png`;
                        link.click();
                    })
                    .catch(err => console.error('Error processing polaroid layout:', err));
            }
        }
        function sharePhotos() {
            if (!finalCanvasData) {
                alert('Please save your photos first!');
                return;
            }

            fetch(finalCanvasData)
                .then(res => res.blob())
                .then(blob => {
                    const file = new File([blob], `photobooth_${Date.now()}.png`, { type: 'image/png' });
                    if (navigator.share) {
                        navigator.share({
                            title: 'My PhotoBooth Strip',
                            text: 'Check out my cute PhotoBooth pictures!',
                            files: [file]
                        }).catch(err => {
                            console.error('Share failed:', err);
                            fallbackShare(file);
                        });
                    } else {
                        fallbackShare(file);
                    }
                })
                .catch(err => {
                    console.error('Error preparing photo for sharing:', err);
                    alert('Failed to prepare photo for sharing.');
                });
        }

        function fallbackShare(file) {
            const url = URL.createObjectURL(file);
            const shareText = 'Check out my PhotoBooth strip! Download it here: ' + url;
            const shareWindow = window.open('', '_blank', 'width=400,height=300');
            shareWindow.document.write(`
                <h3>Share Your Photos</h3>
                <p>Copy this link to share:</p>
                <input type="text" value="${shareText}" style="width: 100%;" readonly>
                <p>Or download and share manually:</p>
                <a href="${url}" download="photobooth.png">Download</a>
            `);
        }
    </script>
</body>
</html>